<div class="time-slider">
  <div class="time-slider-header">
    <button type="button" id="time-play-toggle">▶</button>
    <span class="time-label" id="time-label">00:00:00</span>

    <button type="button" id="time-live">Go Live</button>
  </div>

  <input
    id="time-range"
    type="range"
    min="0"
    max="86400"
    step="1"
    value="0"
  />

  <div class="time-slider-footer">
    <span>00:00</span>
    <span>24:00</span>
  </div>
</div>


<style>
  .time-slider {
    display: inline-flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border-radius: 0.75rem;
    background: rgba(20, 20, 20, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.06);
    backdrop-filter: blur(10px);
    color: #eaeaea;
  }

  .time-slider-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  #time-play-toggle {
    width: 2rem;
    height: 2rem;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    background: transparent;
    color: inherit;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 0.9rem;
    padding: 0;
  }

  #time-play-toggle:hover {
    border-color: rgba(255, 255, 255, 0.4);
  }

  #time-live {
    margin-left: auto;
    padding: 0.25rem 0.6rem;
    border-radius: 6px;
    border: 1px solid rgba(255,255,255,0.25);
    background: rgba(255,255,255,0.08);
    color: inherit;
    cursor: pointer;
    font-size: 0.8rem;
  }

  #time-live:hover {
    background: #8e3131;
  }

  #time-range {
    width: 100%;
    cursor: pointer;
    width: 100%; /* Full-width */
    height: 25px; /* Specified height */
    background: #d3d3d3; /* Grey background */
    outline: none; /* Remove outline */
    opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
    -webkit-transition: .2s;
    transition: opacity .2s;  
  }

  #time-range:hover {
    opacity: 1;
  }

  .time-slider-footer {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    opacity: 0.7;
  }

  /* === LIVE MODE STYLING === */

  .time-slider.live {
    border-color: #ff5252;
    box-shadow: 0 0 12px rgba(255, 82, 82, 0.4);
  }

  .time-slider.live #time-range {
    accent-color: #d40d06;
  }

  .time-slider.live #time-play-toggle {
    border-color: #ff3b3b;
    color: #ff3b3b;
  }

  .time-slider.live #time-live {
    background: #b71c1c;
    border-color: #ff5252;
    color: #ffffff;
  }

</style>

<script>
(() => {
  // Definitions
  const pad = (n: number) => n.toString().padStart(2, '0');
  const clamp = (s: number) => Math.max(0, Math.min(MAX_SECONDS, s));

  const formatTime = (totalSeconds: number) => {
    totalSeconds = clamp(totalSeconds);

    const hours   = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    
    return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
  };

  const secondsSinceMidnight = () => {
    const now = new Date();
    return now.getHours() * 3600 +
            now.getMinutes() * 60 +
            now.getSeconds();
  };

  const setSliderSeconds = (seconds: number) => {
    const s = clamp(seconds);

    slider.value = String(s);
    const text = formatTime(s);
    label.textContent = text
    label.dispatchEvent(
      new CustomEvent("timechange", {detail: {sceonds: s, text}})
    )
  };

  const syncToNow = () => setSliderSeconds(secondsSinceMidnight());
  const tickForward = () => setSliderSeconds(Number(slider.value) + 1);



  // Code Start
  const container   = document.querySelector('.time-slider') as HTMLDivElement;
  const slider      = document.getElementById('time-range') as HTMLInputElement;
  const label       = document.getElementById('time-label') as HTMLSpanElement;
  const playButton  = document.getElementById('time-play-toggle') as HTMLButtonElement;
  const liveButton  = document.getElementById('time-live') as HTMLButtonElement;


  if (!container || !slider || !label || !playButton || !liveButton) {
    console.error("Content not loaded yet!")
    return;
  }
  
  const MAX_SECONDS = 24 * 60 * 60; // 86400
  let timerId: number | null = null;
  let isPlaying = false; // normal playback
  let isLive    = false; // live mode

  const updateUI = () => {
    if (isLive) {
      playButton.textContent = "●";
      container.classList.add("live");
    } else {
      playButton.textContent = isPlaying ? '| |' : '▶'
      container.classList.remove("live");
    }
    liveButton.textContent = isLive ? "Live" : "Go Live";
  }

  const stopTimer = () => {
    if (timerId !== null) {
      clearInterval(timerId);
      timerId = null;
    }
  };

  const updateTimer = () => {
    stopTimer();
    if (!isLive && !isPlaying) return;

    timerId = window.setInterval(() => {
      if (isLive) {
        syncToNow();
      } else if (isPlaying) {
        tickForward();
      }
    }, 1000);
  }



  // --- Event handlers ---

  slider.addEventListener('input', () => {
    isLive = false;
    setSliderSeconds(Number(slider.value));
    updateUI();
    updateTimer();
  });

  playButton.addEventListener('click', () => {
    if (isLive) isLive = false;
    isPlaying = !isPlaying;
    updateUI();
    updateTimer()
  });

  liveButton.addEventListener('click', () => {
    isLive = !isLive;
    if (isLive) {
      syncToNow();
      isPlaying = false;
      window.dispatchEvent(new CustomEvent("flight-go-live"));
    }
    updateUI();
    updateTimer()
  });

  syncToNow();
  updateUI();
  updateTimer();


})();
</script>
